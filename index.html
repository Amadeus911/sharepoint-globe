<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Rotating Globe with Time Callouts</title>
  <style>
    body { margin: 0; overflow: hidden; }
    #globe-container { width:100vw; height:100vh; }
    .label {
      background: rgba(0,0,0,0.6);
      color: #fff; font-family: Arial, sans-serif;
      padding: 2px 6px; border-radius: 4px;
      white-space: nowrap; font-size: .8em;
    }
  </style>
</head>
<body>
  <div id="globe-container"></div>

  <!-- Three.js core -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/build/three.min.js"></script>
  <!-- Globe helper -->
  <script src="https://unpkg.com/three-globe@2.24.10/dist/three-globe.min.js"></script>
  <!-- CSS2DRenderer for labels -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.150.1/examples/jsm/renderers/CSS2DRenderer.js"></script>

  <script>
  (async ()=> {
    const container = document.getElementById('globe-container');
    const scene     = new THREE.Scene();
    const camera    = new THREE.PerspectiveCamera(30, innerWidth/innerHeight, 0.1, 1000);
    const renderer  = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(innerWidth, innerHeight);
    container.appendChild(renderer.domElement);

    // label renderer
    const labelRenderer = new THREE.CSS2DRenderer();
    labelRenderer.setSize(innerWidth, innerHeight);
    labelRenderer.domElement.style.position = 'absolute';
    labelRenderer.domElement.style.top      = 0;
    container.appendChild(labelRenderer.domElement);

    // lights
    scene.add(new THREE.AmbientLight(0xbbbbbb, 0.3));
    const dir = new THREE.DirectionalLight(0xffffff, 0.8);
    dir.position.set(1,1,1);
    scene.add(dir);

    // globe
    const globe = new ThreeGlobe({
      globeImageUrl: 'https://unpkg.com/three-globe/example/img/earth-dark.jpg'
    })
    .rotateY(0.2);

    globe.earthClouds().showClouds(true).cloudsOpacity(0.4);
    scene.add(globe);

    // marker data: city, lat, lng, timezone
    const POINTS = [
      { city: 'London',      lat: 51.5074, lon: -0.1278, tz: 'Europe/London' },
      { city: 'New York',    lat: 40.7128, lon: -74.0060, tz: 'America/New_York' },
      { city: 'Tokyo',       lat: 35.6762, lon: 139.6503, tz: 'Asia/Tokyo' }
      // add more here…
    ];

    // for each point, add a tiny sphere + a CSS2D label
    POINTS.forEach(pt => {
      // convert lat/lng → xyz
      const { lat, lon } = pt;
      const phi   = (90 - lat) * (Math.PI/180);
      const theta = (lon + 180) * (Math.PI/180);
      const r = 100;  // globe radius
      const x = r * Math.sin(phi) * Math.cos(theta);
      const y = r * Math.cos(phi);
      const z = r * Math.sin(phi) * Math.sin(theta);

      // sphere marker
      const dot = new THREE.Mesh(
        new THREE.SphereGeometry(1.5, 8, 8),
        new THREE.MeshBasicMaterial({ color: 'red' })
      );
      dot.position.set(x,y,z);
      scene.add(dot);

      // label
      const div = document.createElement('div');
      div.className = 'label';
      div.textContent = '…';               // placeholder
      const label = new THREE.CSS2DObject(div);
      label.position.copy(dot.position);
      scene.add(label);

      // store for time updates
      pt._label = div;
    });

    camera.position.z = 250;

    // animation + time update loop
    function animate() {
      requestAnimationFrame(animate);
      globe.rotateY(0.001);  // slow spin

      // update each label’s time every frame (you can throttle)
      const now = new Date();
      POINTS.forEach(pt => {
        try {
          const t = now.toLocaleTimeString('en-GB',{
            hour:'2-digit', minute:'2-digit', timeZone: pt.tz
          });
          pt._label.textContent = `${pt.city} ${t}`;
        } catch(_) {
          pt._label.textContent = `${pt.city} –`;
        }
      });

      renderer.render(scene, camera);
      labelRenderer.render(scene, camera);
    }
    animate();

    // handle resizes
    window.addEventListener('resize', ()=> {
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
      labelRenderer.setSize(innerWidth, innerHeight);
    });
  })();
  </script>
</body>
</html>
